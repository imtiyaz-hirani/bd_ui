<div id="grid" class="serrala-grid">
  <ejs-grid #grid  [width]="'100%'"
    [dataSource]="data"
    [gridLines]="'Both'" class="datagrid"
    [height]="600"
    [allowSorting]="true" [allowResizing]="true"
    [showColumnMenu]="true" [allowReordering]="true"
    [allowFiltering]="true" [allowExcelExport]="true"
    [allowPdfExport]="true"
    [allowSelection]="true"
    [selectionSettings]="selectOption"
    [showColumnChooser]="true"
    [infiniteScrollSettings]="infiniteOptions"
    [sortSettings]="initialSort"
    [toolbar]="toolbar"
    (load)="load()"
    (dataBound)="dataBound()"
    (rowDeselected)="onRowDeselect($event)" (rowSelected)="onRowSelect($event)"
    >
    <e-columns>
      <e-column  headerText="Stray No" field="cstrayno" width='150'></e-column>
      <e-column  headerText="Stray Date" field="dstraydate"></e-column>
      <e-column  headerText="Stray Loc" field="Stray Loc"></e-column>
      <e-column  headerText="Emp Code" field="centemplcode"></e-column>
      <e-column  headerText="Emp Name" field="cemplname"></e-column>
      <e-column  headerText="PackDesc" field="cpackdesc"></e-column>
      <e-column  headerText="AwbNo" field="cawbno"></e-column>
      <e-column  headerText="Remarks" field="cremarks"></e-column>
      <e-column  headerText="Status" field="cstatus"></e-column>
      <e-column  headerText="Vehicle No" field="cvehicleno"></e-column>
      <e-column  headerText="Vehicle Orgin" field="cvehicleorigin"></e-column>
      <e-column  headerText="Route" field="croute"></e-column>
      <e-column  headerText="Commodity" field="commodity"></e-column>
      <e-column  headerText="Update Date" field="cupdatedate"></e-column>
      <e-column  headerText="Update Emp" field="cupdateemp"></e-column>
      <e-column  headerText="Display Image" field="Display Image" [template]="actionTemplate" [allowEditing]="false"  [showInColumnChooser]="false">
        <ng-template #actionTemplate let-data>
          <div class="actions d-flex flex-row">
            <ng-container >
              <div [class.disable-btn]="isBulkSelect" title="View Image">
                  <em class="se-view" (click)="viewImage(data.cstrayno)"></em>
              </div>
          </ng-container>

          </div>
        </ng-template>
      </e-column>
    </e-columns>
  </ejs-grid>
</div>

<ng-template #leftToolBarTemplate let-data>
  <div class="toolbar left-toolbar-items">
      <div class="search-bar" *ngIf="!isBulkSelect">
          <div class="d-flex flex-row">
              <div>
                <input id="gridGlobalSearch" placeholder="{{'SHARED.GRID.TOOLBAR.RECORD_SELECTION.SEARCH' | translate}}" (change)="search($event)"  />
              </div>
          </div>
        </div>

          <div class="bulk-actions">
            <ng-container *ngIf="isBulkSelect">
              <div *ngIf="grid.getSelectedRowIndexes().length === 0" class="bulk-select-msg">
                {{'SHARED.GRID.TOOLBAR.RECORD_SELECTION.TITLE' | translate}}
            </div>
            <div class="d-flex flex-row align-items-center action-btns"
                *ngIf=" grid.getSelectedRowIndexes().length !==0">
                <div class="mr-5">
                    <a (click)="selectAllRows()">{{'SHARED.GRID.TOOLBAR.RECORD_SELECTION.SELECT_ALL' | translate}}</a>
                </div>
                <div class="mr-2">
                    <b>{{'SHARED.GRID.TOOLBAR.RECORD_SELECTION.SELECTED_ROW_COUNT' | translate: {selectedRowsCount: grid.getSelectedRowIndexes().length} }}</b>
                </div>
                <div class="mr-2">
                    <a (click)="clearRows()">{{'SHARED.GRID.TOOLBAR.RECORD_SELECTION.CLEAR' | translate}}</a>
                </div>
                <div class="mr-2">
                    <button [disabled]="isDisableButtons" class="e-control e-btn e-lib e-small e-primary" (click)="strayDialogOpen(true)">Stray Mass Update</button>
                </div>
            </div>

            </ng-container>
          </div>
  
  </div>
</ng-template>

<ng-template #rightToolBarTemplate let-data>
  <div class="toolbar right-toolbar-items">
      <div class="icon d-flex row-flex">


          <div class="icon-item" [ngClass]="currentActiveTool == 'groupBy' ? 'active' : ''"
              title="{{'SHARED.GRID.TOOLBAR.RECORD_ACTIONS.GROUP_BY' | translate}}">
              <i class="se-groupby" (click)="opengrouping()"></i>
          </div>

          <div class="icon-item" [ngClass]="currentActiveTool == 'bulkActions' ? 'active' : ''"
                  title="{{'SHARED.GRID.TOOLBAR.RECORD_ACTIONS.BULK_ACTION' | translate}}">
                  <i class="se-bulk-actions" (click)="bulkSelection()"></i>
              </div>


          <div class="icon-item" id="columnChooserIcon"
              [ngClass]="currentActiveTool == 'columnChooser' ? 'active' : ''"
              title="{{'SHARED.GRID.TOOLBAR.RECORD_ACTIONS.COLUMN_CHOOSER' | translate}}">
              <i class="se-view-columns" (click)="openColumnChooser()"></i>
          </div>

          <div class="icon-item" [ngClass]="currentActiveTool == 'search' ? 'active' : ''"
              title="{{'SHARED.GRID.TOOLBAR.RECORD_ACTIONS.SEARCH' | translate}}">
              <i class="se-search" (click)="focusSearch()"></i>
          </div>

          <div class="icon-item" [ngClass]="currentActiveTool == 'search' ? 'active' : ''"
              title="Excel download">
              <i class="se-Export" (click)="exportExcel()"></i>
          </div>



      </div>
  </div>
</ng-template>

<ejs-dialog class="status-message-dialog" #strayImageDialog [position]="strayDialogPosition"
    [visible]="hidden" [width]="700" [height]="'auto'"  [target]="target"
    [header]="'Image'" 
    [showCloseIcon]="true" (overlayClick)="staryImageClose()">
  <ng-template #content>
     <img [src] = "image"/>
  </ng-template>
  </ejs-dialog>

<ejs-dialog class="status-message-dialog" #strayDialog [position]="strayDialogPosition"
    [visible]="hidden" [width]="700" [height]="'auto'"  [target]="target"
    [header]="'Stray Mass Update'" 
    [showCloseIcon]="true" (overlayClick)="staryDialogClose()">
    <ng-template #content>
    <div class="row serra-form mb-6">
      <div class="col-12" >
        <form class="" [formGroup]="strayMassUpdateForm">

          <div class="row">
            <ng-container  [ngSwitch]="item.inputType" *ngFor="let item of strayForm1">
              <div class="col-6" *ngSwitchCase = "'input'">
                <div class="form-group">
                            <ejs-textbox [placeholder]="item.formName" [formControlName]="item.formControlName"
                                floatLabelType="Auto" ></ejs-textbox>
                </div>
            </div>

            <div class="col-6" *ngSwitchCase = "'dropdown'">
              <div class="form-group">
                          <ejs-dropdownlist 
                              [dataSource]="item.dataSource" floatLabelType="Auto"
                              [formControlName]="item.formControlName" [fields]='dropdownFields'
                              [placeholder]="item.formName"
                              [showClearButton]="true">
                          </ejs-dropdownlist>
              </div>
          </div>
            </ng-container>
          </div>

          </form>
      </div>
    </div>
  </ng-template>

  <ng-template #footerTemplate>
    <div class="d-flex flex-row align-items-center">
      <div class="left-content pl-2">
        <div class="body-2">{{'SHARED.PF_SERRALA_DIALOG.DIALOG_LABELS.RESULTS' | translate: {rowCount: '0'} }}</div>
      </div>
      <div class="right-content ml-auto">
        <div class="d-flex flex-row align-items-center">
          <div class="mr-2">
            <button ejs-button  cssClass="e-small" (click)="staryDialogClose()">{{'SHARED.PF_SERRALA_DIALOG.DIALOG_LABELS.CANCEL' | translate}}</button>
          </div>
          <div>
            <button ejs-button [isPrimary]="true" cssClass="e-small" (click)="update()">Update</button>
          </div>
        </div>
      </div>
    </div>
  </ng-template>
  </ejs-dialog>


   


